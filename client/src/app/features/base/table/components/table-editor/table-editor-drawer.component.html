<p-confirmdialog appendTo="body" styleClass="max-w-100" />

<p-drawer
  [visible]="visible()"
  position="right"
  [header]="mode() === 'edit' ? `Edit table: ${table().name}` : 'New table'"
  styleClass="!w-150 custom-drawer"
  (onShow)="onShow()"
  (onHide)="onHide()"
>
  <ng-template #content>
    <form #tableForm="ngForm" (ngSubmit)="onSubmit()">
      <div class="p-5">
        <div class="flex flex-col gap-12">
          <div class="grid grid-cols-3 w-full gap-12">
            <label class="col-span-1">
              <p class="font-medium text-sm">General</p>
            </label>
            <div class="flex flex-col col-span-2 gap-8">
              <div class="flex flex-col gap-1">
                <label for="name" class="text-sm">
                  Name
                  <i class="icon icon-asterisk text-red-500"></i>
                </label>
                <input
                  pInputText
                  id="name"
                  name="name"
                  [pAutoFocus]="true"
                  [invalid]="name.invalid && (name.touched || tableForm.submitted)"
                  [(ngModel)]="tableFormData.name"
                  #name="ngModel"
                  placeholder="Input here..."
                  required
                  pattern="^[a-zA-Z_][a-zA-Z0-9_]*$"
                  maxlength="63"
                />
                @if (name.invalid && (name.touched || tableForm.submitted)) {
                  <p-message severity="error" size="small" variant="simple">
                    @if (name.errors['required']) {
                      Table name is required.
                    } @else if (name.errors?.['pattern']) {
                      Invalid table name.
                    }
                  </p-message>
                }
                <p class="text-surface-500 text-xs">
                  Only letters, numbers, and _ allowed. Must start with a letter or _.
                </p>
              </div>
              <div class="flex flex-col gap-1">
                <label for="description" class="text-sm">Description</label>
                <textarea
                  pTextarea
                  id="description"
                  name="description"
                  [(ngModel)]="tableFormData.comment"
                  rows="5"
                  placeholder="Input here..."
                  maxlength="500"
                ></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
      <p-divider />
      <div class="p-5">
        <div class="grid grid-cols-3 w-full gap-12">
          <label class="col-span-1">
            <p class="font-medium text-sm">Presentation</p>
            <p class="text-surface-500 text-xs">This does not affect the database schema.</p>
          </label>
          <div class="flex flex-col gap-8 col-span-2">
            <div class="flex flex-col gap-1">
              <label for="uiName" class="text-sm">Display Name</label>
              <input
                pInputText
                id="uiName"
                name="uiName"
                [(ngModel)]="tableFormData.presentation.uiName"
                placeholder="Input here..."
                maxlength="63"
              />
              <p class="text-surface-500 text-xs">The display name for the table.</p>
            </div>
          </div>
        </div>
      </div>
      <p-divider />
      @if (mode() === 'add') {
        <div class="p-5">
          <div class="grid grid-cols-3 w-full gap-12">
            <label for="description" class="col-span-1">
              <p class="font-medium text-sm">Settings</p>
            </label>
            <div class="flex flex-col gap-8 col-span-2">
              <div class="flex gap-4">
                <div class="flex flex-col gap-1">
                  <label class="text-sm font-medium">ID type</label>
                  <div class="flex flex-col gap-2">
                    <!-- Integer  (Recommended default) -->
                    <div class="flex gap-4">
                      <p-radiobutton
                        inputId="integer"
                        value="integer"
                        name="idType"
                        [(ngModel)]="tableFormData.idType"
                      />
                      <label for="integer" class="text-sm">
                        Integer
                        <p class="text-surface-500 text-xs">Ex: 1, 2, 3, ..., 2147483647</p>
                        <p class="text-surface-500 text-xs">Limited to ~2.1 billion rows</p>
                      </label>
                    </div>

                    <!-- Big Integer -->
                    <div class="flex gap-4">
                      <p-radiobutton
                        inputId="biginteger"
                        value="biginteger"
                        name="idType"
                        [(ngModel)]="tableFormData.idType"
                      />
                      <label for="biginteger" class="text-sm">
                        Big Integer
                        <p class="text-surface-500 text-xs">
                          Ex: 1, 123456789, 9223372036854775807
                        </p>
                        <p class="text-surface-500 text-xs">
                          Recommended â€“ supports up to ~9 quintillion rows
                        </p>
                      </label>
                    </div>

                    <!-- UUID -->
                    <div class="flex gap-4">
                      <p-radiobutton
                        inputId="uuid"
                        value="uuid"
                        name="idType"
                        [(ngModel)]="tableFormData.idType"
                      />
                      <label for="uuid" class="text-sm">
                        UUID
                        <p class="text-surface-500 text-xs">
                          Ex: 17bd48cc-61c1-4ee1-96bf-6059bfe6d69b
                        </p>
                        <p class="text-surface-500 text-xs">
                          Globally unique, good for distributed systems
                        </p>
                      </label>
                    </div>

                    <!-- Short ID (random 16 characters) -->
                    <div class="flex gap-4">
                      <p-radiobutton
                        inputId="shortid"
                        value="shortid"
                        name="idType"
                        [(ngModel)]="tableFormData.idType"
                      />
                      <label for="shortid" class="text-sm">
                        Short ID (alphanumeric)
                        <p class="text-surface-500 text-xs">Ex: aEF1xWKBLzb4XLrx</p>
                        <p class="text-surface-500 text-xs">
                          Compact & URL-friendly, suitable for public IDs
                        </p>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="flex gap-4">
                <p-checkbox
                  inputId="timestamps"
                  name="timestamps"
                  [(ngModel)]="tableFormData.timestamps"
                  [binary]="true"
                  size="large"
                />
                <label for="timestamps" class="text-sm">
                  Timestamps
                  <p class="text-surface-500 text-xs">
                    Enable automatic "Created At" and "Updated At" columns for this table.
                  </p>
                </label>
              </div>
            </div>
          </div>
        </div>
      }
    </form>
  </ng-template>
  <ng-template #footer>
    <div class="flex justify-end gap-2">
      <p-button label="Cancel" severity="secondary" (click)="cancel()" />
      <p-button
        label="Save"
        [loading]="isSaving()"
        [disabled]="tableForm().invalid"
        (click)="save()"
      />
    </div>
  </ng-template>
</p-drawer>
