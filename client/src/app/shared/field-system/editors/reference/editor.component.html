@let fieldName = field().name;
@let fieldDescription = field().description;

<div class="flex flex-col gap-1 w-full">
  @if (label() !== false) {
    <label class="text-sm" [attr.for]="fieldName">
      <p class="flex items-center gap-1">
        <i [class]="field().icon"></i>
        {{ fieldName }}
        @if (field().required) {
          <i class="icon icon-asterisk text-red-500"></i>
        }
      </p>
      @if (fieldDescription) {
        <p class="text-xs text-surface-500">{{ fieldDescription }}</p>
      }
    </label>
  }
  @if (!viewOnly()) {
    <reference-picker-drawer
      [(visible)]="visibleReferencePicker"
      [field]="field()"
      [value]="value"
      (onSave)="onPick($event)"
    />
  }
  <p-iconfield>
    <input
      pInputText
      #input="ngModel"
      [required]="field().required"
      [invalid]="input.invalid && input.touched"
      [id]="fieldName"
      [placeholder]="placeholder() ?? 'Input identifier... or pick from list'"
      [pAutoFocus]="autoFocus()"
      [readonly]="viewOnly()"
      [ngModel]="isFocused ? value : displayLabel"
      (ngModelChange)="onInputValue($event)"
      fluid
      (focus)="isFocused = true"
      (blur)="isFocused = false"
    />
    <p-inputicon class="icon icon-chevron-down" (click)="visibleReferencePicker = true" />
  </p-iconfield>
  @if (input.invalid && input.touched) {
    <p-message severity="error" size="small" variant="simple">
      @if (input.hasError('required')) {
        {{ fieldName }} is required.
      }
    </p-message>
  }
</div>
